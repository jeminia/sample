machine:
  timezone: Asia/Tokyo
  #environment:
  #  EC2_INSTANCE_COUNT: 1
dependencies:
  pre:
    - sudo pip install awscli
    - sudo curl -o /usr/local/bin/ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
    - sudo chmod +x /usr/local/bin/ecs-cli
  override:
  post:
test:
   pre:
     #- sh ecsup.sh ${EC2_INSTANCE_COUNT}
     - sh setCommonEnv.sh
   override:
     - echo "circle ci test"
   post:
     - sh setCommonEnv.sh ${EC2_INSTANCE_COUNT}
     environment:
       EC2_INSTANCE_COUNT: 10
deployment:
   staging:
    branch: master
    codedeploy:
      test-app:
        deployment_group: test-deploy-group
        application_root: /
        region: ap-northeast-1
        revision_location:
           revision_type: S3
           s3_location:
             bucket: tnagata-circleci
             key_pattern: test/master/test-app-{BRANCH}-{SHORT_COMMIT}
        deployment_group: test-deploy-group
        deployment_config: CodeDeployDefault.OneAtATime
